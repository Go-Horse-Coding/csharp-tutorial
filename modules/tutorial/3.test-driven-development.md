# 3. Desenvolvimento Dirigido a Testes

Agora com o nossa **solution** criada, vamos criar testes para cada comando e suas regras de nosso programa. <br/>
Inicialmente esses testes vão falhar, mas eles vão ser o nosso guia para sabermos se estamos fazendo a implementação correta.

## Criando um projeto de testes

1. Clicando com o botão direito em sua **solution**, vá em **add/new project...**;

<div align="center">
	<img src="/images/tutorial/3.step-1.png" alt="Create New Project" width="650" /> 
</div>

2. Selecione **xUnit Test Project (.NET Core)**;
3. Coloque **CSharpTutorialTests** como o nome do projeto e **clique em criar**;
4. Após criado o projeto de testes, delete o arquivo **UnitTest1.cs**.

## Criando os testes

Com o botão direito em **CSharpTutorialTests**, vá em **add/New Item** e coloque o nome de **MachineTests**.

Sua classe **MachineTests.cs** deve estar assim:
```C#
using System;
using System.Collections.Generic;
using System.Text;

namespace CSharpTutorialTests
{
    public class IMachineTests
    {
    }
}
```

### Vamos agora fazer testes para testar cada uma das funcionalidades de nossa máquina.

O teste deve verificar se um número digitado é adicionado na pilha.
Adicione a seguinte função a sua classe **MachineTests.cs**

```C#
[Fact]
public void EnterCommand_WhenNumber_ShouldAddToStack()
{
	IMachine machine = new Machine();

	machine.EnterCommand("5");

	Assert.Equal(5, machine.Top());
}
```

Perceba que o nosso teste está dando erro. 
Devido as regras passadas, conclui que nossa **Machine** deverá ter uma forma de receber os comandos, 
foi então que nasceu a função **EnterCommand(string command)**. Ao mesmo tempo, para testar, preciso saber qual o número
que se encontra no topo da pilha, para isso agora existe o **Top()**.
 
<br/>
 
No **T.D.D.** (Testes Dirigidos ao Desenvolvimento ou Test Driven Design em inglês) os testes são escritos antes da implementação.
Isso nos obriga a fazer a implementação de forma que os testes passem. Legal não? Nosso software antes de nascer já está testado.

Enquanto isso, vamos adicionar mais alguns testes para testar o comando de adicionar um número:
**obs:** *Os testes para os demais comandos serão adicionados antes da implementação dos mesmos.*

```C#
[Fact]
public void EnterCommand_WhenNegativeNumber_ShouldThrowError()
{
	IMachine machine = new Machine();

	Assert.Throws<IMachineException>(() => machine.EnterCommand("-5"));
}

[Fact]
public void EnterCommand_WhenNumberGreaterThan999_ShouldThrowError()
{
	IMachine machine = new Machine();

	Assert.Throws<IMachineException>(() => machine.EnterCommand("999"));
}

[Fact]
public void EnterCommand_WhenStackFull_ShouldThrowError()
{
	IMachine machine = new Machine();

	Assert.Throws<IMachineException>(() =>
	{
		for (int i = 0; i < 11; i ++)
		{
			machine.EnterCommand("5");
		}
	});
}
```

## Criando o projeto **CSharpTutorial**

Bom, agora iremos fazer o nosso projeto compilar, ele ainda não irá funcionar, porém teremos rodar os testes (e todos obviamente irão falhar).

1. Como anteriormente, clique com o botão direito em sua **solution**, vá em **add/new project...**;
2. Selecione **Console App (.NET Core)**;
3. De o nome de **CSharpTutorial**  e **clique em criar**;

Com o projeto criado, vamos criar uma **interface**, uma **classe** e uma **exception** para a **Machine**.

**IMachine.cs**
```C#
namespace CSharpTutorial
{
    public interface IMachine
    {
        void EnterCommand(string command);
        int Top();
    }
}
```
**Machine.cs**
```C#
using System;

namespace CSharpTutorial
{
    public class Machine : IMachine
    {
        public void EnterCommand(string command)
        {
            throw new NotImplementedException();
        }

        public int Top()
        {
            throw new NotImplementedException();
        }
    }
}
```
**MachineException.cs**
```C#
using System;

namespace CSharpTutorial
{
    public class MachineException : Exception
    {
        public MachineException(string message) : base(message) 
        {
        }
    }
}

```
Quase me esqueci, crie a classe de inicialização **Program.cs** também, ou o projeto não irá funcionar.
```C#
namespace CSharpTutorial
{
    public static class Program
    {
        public static void Main()
        {
        }
    }
}

```

Com todas as nossas classes necessárias para o teste, volte ao projeto de testes e vamos adicionar a referência do projeto **CSharpTutorial**;

1. Com o botão direito em **CSharpTutorialTests**, clique em **Add/Reference**
2. Selecione o projeto **CSharpTutorial** e clique em **Ok**
3. Na classe de teste, **MachineTests.cs**, adicione o seguinte namespace no topo da classe

```C#
using CSharpTutorial;
```

Note que os erros desapareceram! Só resta executarmos os testes, para isso vá em **Test/Run All Tests** e veja todos os nossos testes falharem com sucesso!

<div align="center">
	<img src="/images/tutorial/3.step-2.png" alt="Run All Tests" width="650" /> 
</div>

[4. Máquina de Operações &rarr;](https://github.com/Go-Horse-Coding/csharp-tutorial/blob/master/modules/tutorial/4.operation-machine.md)

